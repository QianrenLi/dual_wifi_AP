{
    "name": "",
    "codebase": {
        "manifest": "manifest.json",
        "tap": "tap.py",
        "agent": "agent.py",
        "util": "util",
        "tools": "tools",
        "data": "stream-replay/data",
        "core": "stream-replay/core",
        "rx": "stream-replay/rx",
        "tx": "stream-replay/tx",
        "configs": "stream-replay/data/configs",
        "android": "stream-replay/android",
        "stream-replay": "stream-replay/*"
    },
    "functions": {
        "send_file": {
            "description": "Send the data to receiver.",
            "parameters": {
                "config" : "data/test.json",
                "duration": 10
            },
            "commands": [
                "(cd stream-replay; ./target/release/stream-replay-tx $config $duration --mon-mac)"
            ]
        },
        "receive_file": {
            "description": "Run stream-replay with default manifest file.",
            "parameters": {
                "duration": 10,
                "port": 0,
                "hyper_parameters": ""
            },
            "commands": [
                "(cd stream-replay; ./target/release/stream-replay-rx $port $duration $hyper_parameters)"
            ],
            "outputs": {
                "throughput": {
                    "cmd": "echo $output_0",
                    "format": "Average Throughput: (\\d+\\.\\d+) Mbps"
                },
                "packet_loss": {
                    "cmd": "echo $output_0",
                    "format": "Packet loss rate: (\\d+\\.\\d+)"
                },
                "stuttering rate":{
                    "cmd": "echo $output_0",
                    "format": "Stuttering rate: (\\d+\\.\\d+)"
                }
            }
        },
        "receive_file_gui": {
            "description": "Run stream-replay with default manifest file.",
            "parameters": {
                "duration": 10,
                "port": 0,
                "hyper_parameters": ""
            },
            "commands": [
                "cd stream-replay; xterm -e ./target/release/stream-replay-rx $port $duration $hyper_parameters"
            ],
            "outputs": {
                "throughput": {
                    "cmd": "echo $output_0",
                    "format": "Average Throughput: (\\d+\\.\\d+) Mbps"
                },
                "packet_loss": {
                    "cmd": "echo $output_0",
                    "format": "Packet loss rate: (\\d+\\.\\d+)"
                },
                "stuttering rate":{
                    "cmd": "echo $output_0",
                    "format": "Stuttering rate: (\\d+\\.\\d+)"
                }
            }
        },
        "start_agent":{
            "description": "Run the agent to apply control and optimization.",
            "parameters":{
                "duration": 10,
                "server_ip": "127.0.0.1",
                "ipc_port": 11112,
                "config_file": ""
            },
            "commands": [
                "python agent.py --use-nn --server-ip $server_ip --server-port $ipc_port --local-port 12345 --config $config_file --sigma 0.15 --period 0.005 --duration $duration"
            ]
        },
        "warm_up":{
            "description": "Cargo build stream-replay.",
            "parameters":{},
            "commands": [
                "(cd stream-replay; cargo build --release)"
            ]
        },
        "read_rtt":{
            "description": "Read rtt",
            "parameters": {
                "port" : 0,
                "tos" : 100
            },
            "outputs": {
                "rtt": {
                    "cmd":"(cd tools; python3 read_rtt.py -f ../stream-replay/logs/rtt-$port@$tos.txt ; rm -f stream-replay/logs/rtt-$port@$tos.txt)",
                    "format":"(\\d+\\.\\d+)"
                }
            }
        },
        "read_ip_addr":{
            "description": "read p2p or wlan ipv4 addr",
            "parameters":{
                "file_name":"ifconfig_output.txt",
                "keyword": "wlan"
            },
            "commands": [
                "cd tools; python3 ip_extract.py"
            ],
            "outputs": {
                "ip_addr": {
                    "cmd": "echo $output_0",
                    "format":"(.*)"
                }
            }
        },
        "set_interference":{
            "description": "Set interference",
            "parameters":{
                "target_ip": "192.168.3.35",
                "target_port": 5201,
                "duration" : 50,
                "mbps": 0
            },
            "commands": [
                "cd tools; python3 env_inter.py -i $target_ip -p $target_port -t $duration -b $mbps"
            ]
        },
        "abuse_manifest":{
            "description": "abuse manifest",
            "parameters":{
                "cmd": "echo Test"
            },
            "commands":[
                "$cmd"
            ]
        },
        "config_network":{
            "description": "config network for transmission",
            "parameters":{
                "interface": "",
                "password": ""
            },
            "commands":[
                "cd tools; echo $password | sudo -S python3 set_route.py -i $interface"
            ],
            "outputs": {
                "cmd_return": {
                    "cmd": "echo $output_0",
                    "format":"(.*)"
                }
            }
        },
        "clean_up_rx":{
            "description": "clean up stream-replay-rx",
            "parameters":{
                "password": ""
            },
            "commands":[
                "echo $password | sudo -S killall stream-replay-rx"
            ]
        }
    }
}